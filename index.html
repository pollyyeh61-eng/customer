<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾æ¥­å®¢æˆ¶ç®¡ç†</title>
    <style>
        body { background-color: #000; color: #D4AF37; font-family: sans-serif; margin: 0; padding: 10px 15px 70px 15px; overflow-x: hidden; }
        .page { display: none; }
        .active { display: block; }
        h1 { color: #D4AF37; text-align: center; font-size: 20px; margin: 8px 0; letter-spacing: 2px; }

        .form-group { margin-bottom: 10px; }
        label { display: block; color: #D4AF37; font-size: 15px; font-weight: bold; margin-bottom: 3px; }
        input, select, textarea {
            width: 100%; padding: 8px 12px; background-color: #0a0a0a;
            border: 1.5px solid #D4AF37; border-radius: 10px; color: #D4AF37; 
            font-size: 16px; box-sizing: border-box; animation: breathe 3s infinite ease-in-out;
        }
        @keyframes breathe {
            0% { border-color: #8A6D3B; box-shadow: 0 0 2px rgba(212, 175, 55, 0.2); }
            50% { border-color: #FFD700; box-shadow: 0 0 8px rgba(212, 175, 55, 0.4); }
            100% { border-color: #8A6D3B; box-shadow: 0 0 2px rgba(212, 175, 55, 0.2); }
        }
        .row { display: flex; gap: 8px; }
        .btn-save {
            width: 100%; padding: 12px; background: linear-gradient(145deg, #D4AF37, #8A6D3B);
            color: #000; border: none; border-radius: 25px; font-size: 18px; font-weight: bold; margin-top: 5px;
        }

        /* æª”æ¡ˆæŠ½å±œæ¨£å¼ */
        .drawer { background: #111; border: 1.2px solid #D4AF37; margin-bottom: 12px; border-radius: 12px; overflow: hidden; }
        .drawer-header { padding: 12px 15px; cursor: pointer; background: #1a1a1a; position: relative; border-bottom: 1px solid #222; }
        .drawer-header h3 { margin: 0 0 6px 0; font-size: 19px; color: #FFD700; }
        .drawer-header .cover-summary { font-size: 14px; color: #B8860B; line-height: 1.5; background: rgba(212, 175, 55, 0.05); padding: 5px 8px; border-radius: 6px; }
        .drawer-header .arrow { position: absolute; right: 15px; top: 15px; font-size: 12px; color: #D4AF37; }

        .drawer-content { display: none; padding: 12px; background: #050505; }
        .history-tag { font-size: 13px; color: #8A6D3B; margin: 15px 0 8px 0; padding-left: 5px; border-left: 3px solid #D4AF37; }
        .record-item { padding: 10px; margin-bottom: 10px; background: #111; border-radius: 8px; border: 0.5px solid #333; }
        .record-item p { margin: 5px 0; font-size: 14px; color: #D4AF37; }
        
        .drawer.open .drawer-content { display: block; }
        .drawer.open .arrow { transform: rotate(180deg); }

        .nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; height: 60px; border-top: 1px solid #D4AF37; z-index: 100; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #8A6D3B; font-size: 11px; }
        .nav-item.active-nav { color: #FFD700; }
        .nav-icon { font-size: 20px; }

        /* æç¤ºæ–‡å­—æ¨£å¼ */
        #search-tip { font-size: 12px; color: #FFD700; margin-top: -5px; margin-bottom: 5px; min-height: 15px; }
    </style>
</head>
<body>

    <div id="page1" class="page active">
        <h1>ç¾æ¥­å®¢æˆ¶ç®¡ç†</h1>
        <div id="search-tip"></div>
        <div class="row">
            <div class="form-group" style="flex:1;"><label>è²´è³“å§“å</label><input type="text" id="name" oninput="autoSearch()"></div>
            <div class="form-group" style="flex:1.5;"><label>è¯ç¹«é›»è©±</label><input type="tel" id="phone" oninput="autoSearch()"></div>
        </div>
        <div class="row">
            <div class="form-group" style="flex:1;"><label>è¡€å‹</label><select id="blood"><option value="">é¸æ“‡</option><option>Aå‹</option><option>Bå‹</option><option>Oå‹</option><option>ABå‹</option></select></div>
            <div class="form-group" style="flex:1;"><label>æ˜Ÿåº§</label><select id="constellation"><option value="">é¸æ“‡</option><option>ç‰¡ç¾Šåº§</option><option>é‡‘ç‰›åº§</option><option>é›™å­åº§</option><option>å·¨èŸ¹åº§</option><option>ç…å­åº§</option><option>è™•å¥³åº§</option><option>å¤©ç§¤åº§</option><option>å¤©è åº§</option><option>å°„æ‰‹åº§</option><option>æ‘©ç¾¯åº§</option><option>æ°´ç“¶åº§</option><option>é›™é­šåº§</option></select></div>
        </div>
        <div class="form-group"><label>æé†’ä¸‹æ¬¡é ç´„é …ç›®</label><input type="text" id="bookItem"></div>
        <div class="form-group"><label>æé†’ä¸‹æ¬¡é ç´„æ™‚é–“</label><input type="datetime-local" id="bookTime"></div>
        <div class="form-group"><label>å¿ƒå¾—å‚™è¨»</label><textarea id="note" rows="2"></textarea></div>
        <button class="btn-save" onclick="handleSave()">ç¢ºèªå„²å­˜</button>
    </div>

    <div id="page2" class="page">
        <h1>åå–®ç¸½è¦½</h1>
        <div id="list-container"></div>
    </div>

    <div class="nav">
        <div class="nav-item active-nav" id="nav1" onclick="showPage(1)"><span class="nav-icon">ğŸ’</span><span>è³‡æ–™ç™»è¨˜</span></div>
        <div class="nav-item" id="nav2" onclick="showPage(2)"><span class="nav-icon">ğŸ“œ</span><span>åå–®ç¸½è¦½</span></div>
    </div>

    <script>
        const DB_KEY = 'BeautySystem_V4';

        // æ ¸å¿ƒåŠŸèƒ½ï¼šè¼¸å…¥å§“åè‡ªå‹•æœå°‹
        function autoSearch() {
            const nameInput = document.getElementById('name').value.trim();
            const phoneInput = document.getElementById('phone').value.trim();
            const tip = document.getElementById('search-tip');
            
            if(!nameInput) {
                tip.innerText = "";
                return;
            }

            let archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            
            // æ‰¾å‡ºæ‰€æœ‰åå­—ç›¸ç¬¦çš„å®¢æˆ¶ (æ”¯æ´åŒå)
            let matches = Object.keys(archive).filter(key => key.split('_')[0] === nameInput);

            if(matches.length === 1) {
                // åªæœ‰ä¸€å€‹äººï¼Œç›´æ¥å¸¶å…¥è³‡è¨Š
                fillData(archive[matches[0]][0]);
                tip.innerText = "âœ¨ å·²è‡ªå‹•å¸¶å…¥æ­¤å®¢äººçš„åŸºæœ¬è³‡æ–™";
            } else if (matches.length > 1) {
                // æœ‰å¤šäººåŒåï¼Œå˜—è©¦ç”¨é›»è©±æ¯”å°
                tip.innerText = "âš ï¸ ç™¼ç¾åŒåå®¢ï¼Œè«‹è¼¸å…¥é›»è©±é€²è¡Œè­˜åˆ¥...";
                let specificMatch = matches.find(key => key.split('_')[1] === phoneInput);
                if(specificMatch) {
                    fillData(archive[specificMatch][0]);
                    tip.innerText = "âœ… å·²é€éé›»è©±è­˜åˆ¥æ­£ç¢ºå®¢æˆ¶";
                }
            } else {
                tip.innerText = "ğŸ†• æ–°å®¢ç™»è¨˜";
            }
        }

        function fillData(lastRecord) {
            document.getElementById('blood').value = lastRecord.blood || "";
            document.getElementById('constellation').value = lastRecord.constellation || "";
            document.getElementById('phone').value = lastRecord.phone || "";
        }

        function handleSave() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            if(!name) { alert('è«‹å¡«å¯«å§“å'); return; }

            // å­˜å„²ç”¨çš„ Key çµåˆ å§“åèˆ‡é›»è©±ï¼Œè§£æ±ºåŒåå•é¡Œ
            const storageKey = `${name}_${phone}`;

            const newRecord = {
                phone: phone,
                blood: document.getElementById('blood').value,
                constellation: document.getElementById('constellation').value,
                bookItem: document.getElementById('bookItem').value,
                bookTime: document.getElementById('bookTime').value,
                note: document.getElementById('note').value,
                saveTime: new Date().toLocaleString()
            };

            let archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            if(!archive[storageKey]) archive[storageKey] = [];
            archive[storageKey].push(newRecord);
            
            localStorage.setItem(DB_KEY, JSON.stringify(archive));
            alert('æ­¸æª”æˆåŠŸï¼');
            document.querySelectorAll('input, textarea, select').forEach(i => i.value = '');
            document.getElementById('search-tip').innerText = "";
            showPage(2);
        }

        function showPage(num) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById('page' + num).style.display = 'block';
            document.getElementById('nav1').classList.toggle('active-nav', num === 1);
            document.getElementById('nav2').classList.toggle('active-nav', num === 2);
            if(num === 2) renderList();
        }

        function toggleDrawer(header) {
            header.parentElement.classList.toggle('open');
        }

        function renderList() {
            const container = document.getElementById('list-container');
            const archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            const keys = Object.keys(archive).reverse();

            if(keys.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#8A6D3B; margin-top:50px;">å€‰åº«å°šç„¡è³‡æ–™</p>';
                return;
            }
            
            container.innerHTML = keys.map(key => {
                const name = key.split('_')[0];
                const records = archive[key];
                const latest = records[records.length - 1];
                
                return `
                <div class="drawer">
                    <div class="drawer-header" onclick="toggleDrawer(this)">
                        <span class="arrow">â–¼</span>
                        <h3>ğŸ‘¤ ${name}</h3>
                        <div class="cover-summary">
                            <strong>ğŸ”” é ç´„ï¼š</strong>${latest.bookItem || 'æœªè¨­'}<br>
                            <strong>â° æ™‚é–“ï¼š</strong>${latest.bookTime ? latest.bookTime.replace('T', ' ') : 'æœªè¨­'}
                        </div>
                    </div>
                    <div class="drawer-content">
                        <p>ğŸ“ é›»è©±ï¼š${latest.phone}</p>
                        <p>âœ¨ å€‹äººï¼š${latest.blood} / ${latest.constellation}</p>
                        <div class="history-tag">æ­·å²ç´€éŒ„ (å…± ${records.length} ç­†)</div>
                        ${records.slice().reverse().map(rec => `
                            <div class="record-item">
                                <p style="font-size:12px; color:#888;">ğŸ•’ ç™»è¨˜ï¼š${rec.saveTime}</p>
                                <p>ğŸ“Œ é …ç›®ï¼š${rec.bookItem || 'ç„¡'}</p>
                                <p>ğŸ“ å‚™è¨»ï¼š${rec.note || 'ç„¡'}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
