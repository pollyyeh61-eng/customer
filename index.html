<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¾æ¥­ç§è—æ‰‹å¸³</title>
    <style>
        :root {
            --gold: #D4AF37;
            --dark-gold: #8A6D3B;
            --bright-gold: #FFD700;
            --bg-black: #050505;
            --card-bg: #111111;
        }

        body { 
            background-color: #000; color: var(--gold); 
            font-family: -apple-system, sans-serif; 
            margin: 0; padding: 10px 15px 80px 15px; 
        }

        .page { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { color: var(--gold); text-align: center; font-size: 20px; margin: 10px 0; letter-spacing: 2px; }

        /* è¼¸å…¥æ¡†èˆ‡é‡‘è‰²å…‰æšˆ */
        .form-group { margin-bottom: 8px; }
        label { display: block; color: var(--gold); font-size: 14px; margin-bottom: 3px; font-weight: bold; }
        
        input, select, textarea {
            width: 100%; padding: 10px; background-color: #000;
            border: 1px solid var(--dark-gold); border-radius: 10px; color: #fff; 
            font-size: 16px; box-sizing: border-box; transition: all 0.3s ease;
            outline: none;
        }

        input:focus { border-color: var(--bright-gold); box-shadow: 0 0 10px rgba(212, 175, 55, 0.4); }

        .row { display: flex; gap: 8px; }

        /* é‡‘é¡å°ˆç”¨æ¨£å¼ */
        .price-input { color: #00FF00; font-weight: bold; border-color: #006400; }

        .btn-save {
            width: 100%; padding: 14px; 
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: #000; border: none; border-radius: 25px; 
            font-size: 18px; font-weight: bold; margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        .btn-save:active { transform: scale(0.96); }

        /* æª”æ¡ˆæŠ½å±œ */
        .drawer { background: var(--card-bg); border: 1px solid #222; margin-bottom: 12px; border-radius: 12px; overflow: hidden; }
        .drawer-header { padding: 12px; cursor: pointer; position: relative; background: #1a1a1a; }
        .drawer-header h3 { margin: 0 0 5px 0; font-size: 19px; color: var(--bright-gold); }
        .cover-summary { font-size: 13px; color: #aaa; border-left: 2px solid var(--gold); padding-left: 8px; }
        
        .drawer-content { display: none; padding: 12px; background: #080808; border-top: 1px solid #333; }
        .drawer.open .drawer-content { display: block; }

        .record-item { padding: 10px; margin-bottom: 10px; background: #151515; border-radius: 8px; border: 1px solid #222; }
        .history-tag { font-size: 12px; color: var(--dark-gold); margin-bottom: 8px; font-weight: bold; }

        .nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #000; display: flex; height: 65px; border-top: 1px solid var(--dark-gold); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; }
        .nav-item.active-nav { color: var(--bright-gold); }
    </style>
</head>
<body>

    <div id="page1" class="page active">
        <h1>ç¾æ¥­å®¢æˆ¶ç®¡ç†</h1>
        <div id="search-tip" style="font-size:12px; text-align:center; color: var(--bright-gold); height:15px; margin-bottom:5px;"></div>
        
        <div class="row">
            <div class="form-group" style="flex:1;"><label>è²´è³“å§“å</label><input type="text" id="name" oninput="autoSearch()"></div>
            <div class="form-group" style="flex:1.5;"><label>è¯ç¹«é›»è©±</label><input type="tel" id="phone" oninput="autoSearch()"></div>
        </div>

        <div class="form-group"><label>æœ¬æ¬¡æ¶ˆè²»é …ç›®</label><input type="text" id="thisItem" placeholder="å¦‚ï¼šéœ§çœ‰ã€æ·±å±¤æ´—é«®"></div>
        <div class="form-group"><label>æ“ä½œç´€éŒ„</label><textarea id="thisLog" rows="2" placeholder="ä½¿ç”¨çš„è‰²è™Ÿã€è—¥æ°´ã€æ²åº¦ç­‰..."></textarea></div>
        <div class="form-group"><label>æ¶ˆè²»é‡‘é¡ ($)</label><input type="number" id="price" class="price-input" placeholder="0"></div>

        <div class="form-group"><label>æé†’ä¸‹æ¬¡é ç´„é …ç›®</label><input type="text" id="bookItem"></div>
        <div class="form-group"><label>æé†’ä¸‹æ¬¡é ç´„æ™‚é–“</label><input type="datetime-local" id="bookTime"></div>

        <div style="display: flex; gap: 8px;">
            <div class="form-group" style="flex:1;"><label>è¡€å‹</label><select id="blood"><option value="">é¸æ“‡</option><option>Aå‹</option><option>Bå‹</option><option>Oå‹</option><option>ABå‹</option></select></div>
            <div class="form-group" style="flex:1;"><label>æ˜Ÿåº§</label><select id="constellation"><option value="">é¸æ“‡</option><option>ç‰¡ç¾Šåº§</option><option>é‡‘ç‰›åº§</option><option>é›™å­åº§</option><option>å·¨èŸ¹åº§</option><option>ç…å­åº§</option><option>è™•å¥³åº§</option><option>å¤©ç§¤åº§</option><option>å¤©è åº§</option><option>å°„æ‰‹åº§</option><option>æ‘©ç¾¯åº§</option><option>æ°´ç“¶åº§</option><option>é›™é­šåº§</option></select></div>
        </div>
        
        <div class="form-group"><label>å¿ƒå¾—å‚™è¨»</label><textarea id="note" rows="2"></textarea></div>
        
        <button class="btn-save" onclick="handleSave()">ç¢ºèªå„²å­˜å…¥åº«</button>
    </div>

    <div id="page2" class="page">
        <h1>æª”æ¡ˆç¸½è¦½</h1>
        <input type="text" id="keyword" placeholder="ğŸ” å³æ™‚æœå°‹å§“åæˆ–é›»è©±..." oninput="renderList()" style="margin-bottom:15px;">
        <div id="list-container"></div>
    </div>

    <div class="nav">
        <div class="nav-item active-nav" id="nav1" onclick="showPage(1)"><span style="font-size:22px;">ğŸ’</span><span>è³‡æ–™ç™»è¨˜</span></div>
        <div class="nav-item" id="nav2" onclick="showPage(2)"><span style="font-size:22px;">ğŸ“œ</span><span>åå–®ç¸½è¦½</span></div>
    </div>

    <script>
        const DB_KEY = 'BeautyPro_V6';

        function autoSearch() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const tip = document.getElementById('search-tip');
            if(!name) { tip.innerText = ""; return; }

            const archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            const matches = Object.keys(archive).filter(k => k.split('_')[0] === name);

            if(matches.length === 1) {
                const lastRec = archive[matches[0]][archive[matches[0]].length - 1];
                document.getElementById('phone').value = lastRec.phone || "";
                document.getElementById('blood').value = lastRec.blood || "";
                document.getElementById('constellation').value = lastRec.constellation || "";
                tip.innerText = "â­ å·²è‡ªå‹•å¸¶å…¥èˆŠå®¢åŸºæœ¬è³‡æ–™";
            } else if (matches.length > 1) {
                tip.innerText = "â“ æœ‰åŒåå®¢ï¼Œè«‹è¼¸å…¥é›»è©±å€åˆ†";
            } else {
                tip.innerText = "ğŸ†• æ–°å®¢ç™»è¨˜";
            }
        }

        function handleSave() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            if(!name) { alert('è«‹å¡«å¯«å§“å'); return; }

            const storageKey = `${name}_${phone}`;
            const newRecord = {
                phone,
                blood: document.getElementById('blood').value,
                constellation: document.getElementById('constellation').value,
                thisItem: document.getElementById('thisItem').value,
                thisLog: document.getElementById('thisLog').value,
                price: document.getElementById('price').value,
                bookItem: document.getElementById('bookItem').value,
                bookTime: document.getElementById('bookTime').value,
                note: document.getElementById('note').value,
                saveTime: new Date().toLocaleString()
            };

            const archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            if(!archive[storageKey]) archive[storageKey] = [];
            archive[storageKey].push(newRecord);
            localStorage.setItem(DB_KEY, JSON.stringify(archive));
            
            alert('æ­¸æª”æˆåŠŸï¼');
            document.querySelectorAll('input, textarea, select').forEach(i => i.value = '');
            showPage(2);
        }

        function showPage(num) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + num).classList.add('active');
            document.getElementById('nav1').classList.toggle('active-nav', num === 1);
            document.getElementById('nav2').classList.toggle('active-nav', num === 2);
            if(num === 2) renderList();
        }

        function renderList() {
            const container = document.getElementById('list-container');
            const keyword = document.getElementById('keyword').value.toLowerCase();
            const archive = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
            const keys = Object.keys(archive).reverse();

            const filteredKeys = keys.filter(k => k.toLowerCase().includes(keyword));

            container.innerHTML = filteredKeys.map(key => {
                const records = archive[key];
                const latest = records[records.length - 1];
                return `
                <div class="drawer">
                    <div class="drawer-header" onclick="this.parentElement.classList.toggle('open')">
                        <h3>ğŸ‘¤ ${key.split('_')[0]}</h3>
                        <div class="cover-summary">
                            ä¸‹æ¬¡ï¼š${latest.bookItem || 'æœªè¨­'} | ${latest.bookTime ? latest.bookTime.replace('T', ' ') : 'æ™‚é–“æœªè¨­'}
                        </div>
                    </div>
                    <div class="drawer-content">
                        <div class="history-tag">ğŸ’ æ­·å²æ¶ˆè²»ç´€éŒ„ (${records.length})</div>
                        ${records.slice().reverse().map(rec => `
                            <div class="record-item">
                                <div style="font-size:11px; color:#666;">ğŸ•’ ${rec.saveTime}</div>
                                <div style="color:var(--gold); margin:4px 0;">ğŸ›ï¸ é …ç›®ï¼š${rec.thisItem || 'æœªå¡«'}</div>
                                <div style="color:#ddd; font-size:14px;">ğŸ“ è¨˜éŒ„ï¼š${rec.thisLog || 'ç„¡'}</div>
                                <div style="color:#00FF00; font-weight:bold; margin-top:4px;">ğŸ’° é‡‘é¡ï¼š$${rec.price || 0}</div>
                                <hr style="border:0; border-top:1px dashed #333; margin:8px 0;">
                                <div style="color:var(--bright-gold); font-size:13px;">ğŸ”” ä¸‹æ¬¡é ç´„ï¼š${rec.bookItem}</div>
                                <div style="font-size:12px; color:#999;">ğŸ’¬ å‚™è¨»ï¼š${rec.note}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
